var app=angular.module("MobileAngularUiExamples",["ngRoute","mobile-angular-ui","mobile-angular-ui.gestures"]),preventCache="?"+Math.random().toString(36);app.config(function($routeProvider){app.asyncLoad=function(){return["$q","$route","$rootScope",function($q,$route,$rootScope){var deferred=$q.defer(),r={};r.params=getQueryStringByName("params"),r.sign=getQueryStringByName("sign");var getUserUrl="http://m.xiaoniubang.com/ebank/mpi/decode.php?params="+r.params+"&sign="+r.sign;if(r.params&&r.sign)$.ajax({url:getUserUrl,type:"get",async:!1,success:function(data){var uArr=data.split("}");data=uArr[0]+'}"';var u=eval("("+eval(data)+")");u.id=u.userId,u.mobile=u.phoneNumber,setToken(u,!1),getUserInfo(u,function(r){if(1==r.status){var user=r.data;user.lat=u.latitude,user.lng=u.longitude,"13646222355"==user.mobile,setToken(user,!1),deferred.resolve()}else alertWarning("获取用户信息失败！"),deferred.reject()})},cache:!1,timeout:5e3,error:function(){alert("获取用户信息超时"),deferred.reject()}});else if($rootScope.user&&$rootScope.user.id){var u=$rootScope.user;u.isNewUser=u.isnewuser,u.id=u.sz_user_id,getUserInfo(u,function(r){if(1==r.status){var user=r.data;user.lat=u.lat,user.lng=u.lng,setToken(user,!1),"13646222355"==user.mobile,deferred.resolve()}else alertWarning("获取用户信息失败！"),deferred.reject()})}return deferred.promise}]},$routeProvider.when("/",{templateUrl:"views/teachers.html"+preventCache,reloadOnSearch:!1,resolve:{load:app.asyncLoad()}}),$routeProvider.when("/teacher",{templateUrl:"views/teacher.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/order",{templateUrl:"views/order.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/order/:cleanerId",{templateUrl:"views/order.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/address",{templateUrl:"views/address.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/payment",{templateUrl:"views/payment.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/payment/:orderId",{templateUrl:"views/payment.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/payment/:orderId/:isService",{templateUrl:"views/payment.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/recharge",{templateUrl:"views/recharge.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/recharge/:value",{templateUrl:"views/recharge.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/mine",{templateUrl:"views/mine.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/login",{templateUrl:"views/registe.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/services",{templateUrl:"views/services.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/service",{templateUrl:"views/service.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/myCars",{templateUrl:"views/myCars.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/car",{templateUrl:"views/car.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/carCity",{templateUrl:"views/carCity.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/carCity/:type",{templateUrl:"views/carCity.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/carBrand",{templateUrl:"views/carBrand.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/carSubBrand",{templateUrl:"views/carSubBrand.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/carSubBrand/:id",{templateUrl:"views/carSubBrand.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/myOrders",{templateUrl:"views/myOrders.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/myCoupons",{templateUrl:"views/myCoupons.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/accountDetail",{templateUrl:"views/accountDetail.html"+preventCache,reloadOnSearch:!1}),$routeProvider.when("/oauth2",{templateUrl:"views/oauth2.html?"+preventCache}),$routeProvider.when("/error",{templateUrl:"views/error.html?"+preventCache}),$routeProvider.when("/pay/success/:tradeNo",{templateUrl:"views/paySuccess.html?"+preventCache}),$routeProvider.otherwise({redirectTo:"/"})}),app.controller("MainController",function($rootScope,dataStringify,httpRequest,$scope,$location){$scope.userAgent=navigator.userAgent,$rootScope.leftbar="fa-bars",$scope.isShowNavbar=!0,$rootScope.isAndroid=getMobileType()==MobileTypes.Android?!0:!1,$rootScope.$on("$routeChangeStart",function(){$rootScope.loading=!0}),$rootScope.user=getToken(),$rootScope.rootAct=$rootScope.user,$rootScope.user&&$rootScope.user.id,$rootScope.$on("$routeChangeSuccess",function(){$rootScope.loading=!1,$scope.isShowNavbar=isWeixin()?!0:!0,"/"===$location.path()?$scope.isShowTopLine=!1:isWeixin()&&($scope.isShowTopLine=!1),$rootScope.shareToFriends=function(){if(isWeixin())$rootScope.fadeInShare();else{var arrButton=["确定"];openDialog("请在微信内打开并分享到朋友圈","",arrButton,null,function(r){})}},$rootScope.fadeOutShare=function(){$("#shareHint").fadeOut()},$rootScope.fadeInShare=function(){$("#shareHint").fadeIn()}});for(var scrollItems=[],i=1;100>=i;i++)scrollItems.push("Item "+i);$scope.scrollItems=scrollItems,$scope.bottomReached=function(){alert("Congrats you scrolled to the end of the list!")},$scope.back=function(){if($rootScope.isNoBack)return $rootScope.couponPage=!1,void($rootScope.isNoBack=!1);if("/"==$location.path())return void $rootScope.Ui.toggle("uiSidebarLeft");var path=$location.path(),newPath="";if(newPath=defindeBackBtn[path],path.indexOf("myCars")>-1){var cleaner=getCleaner();newPath=defindeBackBtn[path]+"/"+cleaner.id}if(path.indexOf("myCars")>-1){var cleaner=getCleaner();newPath=defindeBackBtn[path]+"/"+cleaner.id}return path.indexOf("order")>-1&&(newPath=defindeBackBtn["/order"]),path.indexOf("payment")>-1&&$rootScope.redirectPath&&(newPath=$rootScope.redirectPath),newPath?void $location.path(newPath):void history.back()},$scope.goHome=function(){$location.path("/")},$rootScope.getStar=function(value){$rootScope.star=[];var star="";if(value+="",0==value.length)star='<i class="main-text2 fa fa-star-o"></i><i class="main-text2 fa fa-star-o"></i><i class="main-text2 fa fa-star-o"></i><i class="main-text2 fa fa-star-o"></i><i class="main-text2 fa fa-star-o"></i>',$rootScope.star=["fa-star-o","fa-star-o","fa-star-o","fa-star-o","fa-star-o"];else if(-1==value.indexOf(".")){value=parseInt(value),value=value>5?5:value;for(var i=0;value>i;i++)star+='<i class="main-text2 fa fa-star"></i>',$rootScope.star.push("fa-star");for(var i=0;5-value>i;i++)star+='<i class="main-text2 fa fa-star-o"></i>',$rootScope.star.push("fa-star-o")}else{value=parseInt(value),value=value>4?4:value;for(var i=0;value>i;i++)star+='<i class="main-text2 fa fa-star"></i>',$rootScope.star.push("fa-star");for(var i=0;4-value>i;i++)star+='<i class="main-text2 fa fa-star-o"></i>',$rootScope.star.push("fa-star-o");star+='<i class="main-text2 fa fa-star-half-o"></i>',$rootScope.star.push("fa-star-half-o")}},$scope.navigateTo=function(d){$location.path("/"+d)},$rootScope.getOrderStatus=function(s){s=parseInt(s);var status="";switch(s){case 1:status="刚下单";break;case 2:status="已接受";break;case 3:status="洗车中";break;case 4:status="已洗完";break;case 5:status="已确认";break;case 6:status="已取消";break;case 7:status="已过期";break;case 8:status="不满意"}return status}});